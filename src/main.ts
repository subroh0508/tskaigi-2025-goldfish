import './style.css'
import p5 from 'p5'

// p5.jsのスケッチを定義
const sketch = (p: p5) => {
  // 金魚の位置と動きのパラメータ
  let x = 0
  let y = 0
  let angle = 0
  let tailAngle = 0
  let direction = 1 // 金魚の向き（1: 右向き, -1: 左向き）
  let speedFactor = 0.01 // 速度係数

  // 初期設定
  p.setup = () => {
    // キャンバスを作成
    p.createCanvas(800, 600)
    // 背景色を設定（水色）
    p.background(210, 240, 255)

    // 初期位置を中央に設定
    x = p.width / 2
    y = p.height / 2
  }

  // 詳細なポリゴンでSVGパスを描画する関数
  const drawSVGPathAsDetailedPolygon = (x: number, y: number, size: number, direction: number) => {
  p.push();
  p.translate(x, y);
  p.scale((direction * size) / 1000, size / 1000);
  
  const baseColor = p.color(255, 45, 45);
  p.fill(baseColor);
  p.noStroke();
  
  // SVGパスの点を多数のポイントに変換して滑らかなポリゴンを作成
  const points = [
    // 開始点
    [890.004, 157.419],
    
    // 細かく点を追加してカーブを近似
    [870.0, 165.0], [850.0, 172.0], [830.0, 179.0], [810.0, 182.0], 
    [790.0, 176.0], [780.0, 170.0], [775.0, 165.0], [770.452, 161.233],
    
    [772.0, 160.0], [775.0, 158.0], [780.0, 156.0], [785.0, 154.0], 
    [790.0, 153.0], [797.552, 152.503],
    
    [795.0, 150.0], [792.0, 148.0], [788.409, 146.179],
    
    [789.0, 144.0], [790.0, 142.0], [793.0, 140.0], [792.0, 136.0], 
    [790.0, 133.0], [787.894, 130.726],
    
    [787.0, 129.0], [784.0, 126.0], [780.0, 123.0], [783.0, 120.0], 
    [786.0, 118.0], [790.151, 117.351],
    
    [800.0, 115.0], [810.0, 114.0], [820.0, 116.0], [830.0, 119.0], 
    [840.0, 122.0], [853.445, 125.119],
    
    [850.0, 123.0], [845.0, 120.0], [840.0, 117.0], [830.0, 110.0], 
    [820.0, 102.0], [812.122, 95.282],
    
    [800.0, 90.0], [780.0, 80.0], [760.0, 75.0], [740.0, 80.0], 
    [720.0, 90.0], [705.022, 102.241],
    
    [710.0, 95.0], [720.0, 88.0], [730.0, 82.0], [740.0, 77.0], 
    [760.0, 73.0], [780.962, 72.119],
    
    [770.0, 70.0], [760.0, 68.0], [740.0, 67.0], [720.0, 68.0], 
    [710.0, 69.0], [702.517, 69.802],
    
    [702.5, 69.7], [705.0, 65.0], [710.0, 58.0], [720.0, 50.0], 
    [735.0, 43.0], [750.0, 38.0], [762.159, 37.332],
    
    [765.0, 37.0], [780.0, 36.0], [800.0, 37.0], [820.0, 45.0], 
    [835.0, 53.0], [850.541, 61.166],
    
    [860.0, 68.0], [870.0, 75.0], [880.0, 85.0], [885.0, 95.0], 
    [895.0, 105.0], [910.206, 117.274],
    
    [915.0, 115.0], [925.0, 112.0], [935.0, 110.0], [945.0, 112.0], 
    [951.801, 113.922],
    
    [950.0, 105.0], [949.0, 95.0], [948.199, 89.774],
    
    [950.0, 88.0], [955.0, 85.0], [960.0, 84.0], [965.0, 86.0], 
    [970.0, 89.0], [976.326, 92.47],
    
    [975.0, 100.0], [972.0, 110.0], [968.0, 118.0], [965.647, 122.736],
    
    [970.0, 126.0], [975.0, 130.0], [980.0, 135.0], [985.0, 140.0], 
    [990.0, 145.0], [995.0, 150.0], [1000.04, 154.882],
    
    [1000.5, 154.0], [1002.0, 155.0], [1005.0, 157.0], [1008.0, 160.0], 
    [1010.82, 162.204],
    
    [1012.0, 164.0], [1013.5, 167.0], [1015.0, 170.0], [1014.5, 173.0], 
    [1013.83, 174.832],
    
    [1014.5, 177.0], [1016.0, 180.0], [1016.5, 185.0], [1015.0, 190.0], 
    [1013.5, 194.0], [1012.83, 197.45],
    
    [1012.0, 200.0], [1010.0, 203.0], [1006.0, 206.0], [1002.0, 209.0], 
    [998.0, 210.0], [994.98, 210.824],
    
    [994.0, 211.5], [992.0, 212.5], [990.0, 213.5], [987.0, 214.0], 
    [985.0, 214.2], [983.103, 214.302],
    
    [981.0, 214.2], [979.0, 214.0], [976.0, 213.0], [973.0, 211.0], 
    [972.0, 210.0], [971.358, 209.838],
    
    [971.3, 209.8], [971.2, 209.78], [971.0, 209.76], [970.825, 209.718],
    
    [969.0, 209.5], [965.0, 209.0], [960.0, 208.0], [950.0, 206.0], 
    [940.0, 204.0], [930.0, 200.0], [922.452, 197.381],
    
    [920.0, 200.0], [915.0, 205.0], [910.0, 210.0], [906.0, 216.0], 
    [902.603, 222.784],
    
    [900.0, 222.0], [896.0, 220.0], [892.0, 217.0], [888.0, 212.0], 
    [886.0, 205.0], [885.192, 200.531],
    
    [890.0, 198.0], [895.0, 195.0], [900.0, 193.0], [905.0, 191.0], 
    [908.145, 190.272],
    
    [905.0, 188.0], [902.0, 185.0], [898.0, 180.0], [895.0, 175.0], 
    [892.0, 168.0], [890.0, 160.0], [890.004, 157.419]
  ];
  
  p.beginShape();
  for (const point of points) {
    p.vertex(point[0], point[1]);
  }
  p.endShape(p.CLOSE);
  
  p.pop();
};

  // 金魚を描画するメイン関数
  const drawGoldfish = (x: number, y: number, size: number, tailAngle: number, direction: number) => {
  // 詳細なポリゴンバージョンを使用（より滑らかな結果）
  drawSVGPathAsDetailedPolygon(x, y, size, direction);
  
  // 目や他のディテールを追加
  p.push();
  p.translate(x, y);
  p.scale(size / 1000 * direction, size / 1000);
  
  // 目を追加
  p.fill(0);
  p.ellipse(950, 110, 15, 15);
  p.fill(255);
  p.ellipse(953, 107, 5, 5);
  
  p.fill(0);
  p.ellipse(950, 135, 15, 15);
  p.fill(255);
  p.ellipse(953, 132, 5, 5);
  
  // ハイライト（光の反射）
  p.fill(255, 255, 255, 70);
  p.ellipse(850, 120, 150, 80);
  
  // 尾びれのアニメーション（必要に応じて）
  if (tailAngle !== 0) {
    // 尾の部分だけを別に描画して動きを付ける
    p.push();
    p.translate(770, 160);
    p.rotate(tailAngle * 0.1);
    
    p.fill(255, 45, 45);
    p.beginShape();
    for (let i = 0; i < 20; i++) {
      const angle = p.map(i, 0, 19, -p.PI * 0.4, p.PI * 0.4);
      const r = 40 + p.sin(angle * 2) * 15;
      p.vertex(-r * p.cos(angle), r * p.sin(angle));
    }
    p.vertex(0, 0);
    p.endShape(p.CLOSE);
    
    p.pop();
  }
  
  p.pop();
};

  // 描画ループ
  p.draw = () => {
    // 背景をクリア（水色）
    p.background(210, 240, 255)

    // 大きめのサイズで金魚を描画（キャンバスの中央に配置）
    const goldfishSize = 400; // サイズを400に大きく設定（元の300から変更）

    // 尾びれを動かすためのアニメーション値
    const tailWiggle = p.sin(p.frameCount * 0.05) * 0.5;

    // 中央に大きく金魚を描画
    drawGoldfish(
      p.width / 2,  // x座標（キャンバスの中央）
      p.height / 2, // y座標（キャンバスの中央）
      goldfishSize, // サイズ（大きく設定）
      tailWiggle,   // 尾びれの動き
      1             // 向き（1: 右向き、-1: 左向き）
    );
  }
}

// p5インスタンスを作成し、#appに追加
new p5(sketch, document.querySelector<HTMLDivElement>('#app')!)